# Ответы на вопросы из задания к ДЗ 2

- Конфиг postgres в `./build/postgres/postgresql.conf`
- Пул соединений создается в `./pkg/postgres/postgres.go` в функции `NewPgxDatabase()`
- Кол-во соединений в пуле указывается при инициализации каждого из сервисов, например, в `./microservices/auth/app/app.go:42`

## SQL Injections
> Ваше приложение должно строить SQL запросы с учетом защиты от SQL инъекций. У вас должны быть - валидация входных данных, экранирование спецсимволов, использование Prepared Statement.

Защита от SQL Инъекций инкапсулирована в выбранном нами драйвере (`github.com/jackc/pgx/v5`).

## Пулл соединений и параметры соедений

> Вопрос в том, как правильно сбалансировать количество содениений в connection pool и значение max_connections? 

Каждое соединение требует ресурсов сервера. Но дает возможность держать больше одновременных соединений.  
С учетом возможной нагрузки на наше приложение мы решили выделить 10 соединений для пула каждого из 6 сервисов:
- main
- auth
- csat
- profile
- promotion
- review

max_connections = 65 = (10 * 6 + 5 резервных соединений).

## Настройка параметров сервера и клиента
### Таймауты

> Настроить клиентские параметры statement_timeout и lock_timeout, выбор значений аргументировать ментору. 

`statement_timeout`: Все запросы должны выполняться менее 5 секунд. Если больше, то что-то идет не так, нужно отменять). Если будем дожидаться исполнения каждого запроса в базу, нас будет легко заДДоСить(  
`lock_timeout`: Тоже не стоит долго ждать

### Логгирование и протоколирование медленных запросов

- Логируем запросы, длительность которых больше 1с
- Логируем время выполнения
- Собираем статистику всех запросов (включая служебные по типу `CREATE TABLE`)
- В формате json подробно логируем план выполнения долгих запросов и триггеров, следим за использованием буфера

